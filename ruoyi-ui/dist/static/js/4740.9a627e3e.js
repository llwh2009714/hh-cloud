"use strict";(self["webpackChunkruoyi"]=self["webpackChunkruoyi"]||[]).push([[4740],{64740:function(t,e,a){a.r(e),a.d(e,{default:function(){return m}});var l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"con"},[a("h2",[t._v("采购合同")]),a("el-divider",{attrs:{direction:"horizontal"}}),a("el-form",{ref:"elForm",attrs:{model:t.form,rules:t.rules1,size:"medium","label-width":"180px","label-position":"left"}},[a("h3",[t._v("合同基本信息")]),a("el-row",{staticStyle:{"flex-wrap":"wrap"},attrs:{type:"flex",justify:"space-between",align:"top",gutter:15}},[a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"合同名称",prop:"eHname"}},[a("el-input",{staticClass:"cInput",attrs:{clearable:""},model:{value:t.form.eHname,callback:function(e){t.$set(t.form,"eHname",e)},expression:"form.eHname"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"合同编号",prop:"eHcode"}},[a("el-input",{staticClass:"cInput",attrs:{clearable:"",placeholder:"系统自动生成",readonly:""},model:{value:t.form.eHcode,callback:function(e){t.$set(t.form,"eHcode",e)},expression:"form.eHcode"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"类型",prop:"eType"}},[a("el-input",{staticClass:"cInput",attrs:{clearable:"",readonly:""},model:{value:t.form.eType,callback:function(e){t.$set(t.form,"eType",e)},expression:"form.eType"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"密级",prop:"eCon"}},[a("el-select",{staticClass:"cInput",attrs:{placeholder:"请选择"},model:{value:t.form.eCon,callback:function(e){t.$set(t.form,"eCon",e)},expression:"form.eCon"}},t._l(t.mjOptions,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"开始时间",prop:"eStartdate"}},[a("el-date-picker",{staticClass:"cInput",attrs:{type:"date"},model:{value:t.form.eStartdate,callback:function(e){t.$set(t.form,"eStartdate",e)},expression:"form.eStartdate"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"结束时间",prop:"eEnddate"}},[a("el-date-picker",{staticClass:"cInput",attrs:{type:"date"},model:{value:t.form.eEnddate,callback:function(e){t.$set(t.form,"eEnddate",e)},expression:"form.eEnddate"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"交付日期",prop:"eDeliveryTime"}},[a("el-date-picker",{staticClass:"cInput",attrs:{type:"date"},model:{value:t.form.eDeliveryTime,callback:function(e){t.$set(t.form,"eDeliveryTime",e)},expression:"form.eDeliveryTime"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"合同金额",prop:"eAmount"}},[a("el-input",{staticClass:"cInput",attrs:{clearable:"",readonly:""},model:{value:t.form.eAmount,callback:function(e){t.$set(t.form,"eAmount",e)},expression:"form.eAmount"}}),a("span",{staticStyle:{color:"red"}},[t._v(" * 合同标的清单总价")])],1),a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"合同情况说明",prop:"eDescription"}},[a("el-col",[a("el-input",{staticClass:"cInput",attrs:{type:"textarea",rows:4,clearable:""},model:{value:t.form.eDescription,callback:function(e){t.$set(t.form,"eDescription",e)},expression:"form.eDescription"}})],1)],1)],1),a("h3",[t._v("相关项目信息")]),a("el-row",{staticStyle:{"flex-wrap":"wrap"},attrs:{type:"flex",justify:"space-between",align:"top",gutter:15}},[a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"相关项目名称",prop:"tenderName"}},[a("el-input",{staticClass:"cInput",attrs:{readonly:""},model:{value:t.form.tenderName,callback:function(e){t.$set(t.form,"tenderName",e)},expression:"form.tenderName"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"项目编号",prop:"tenderNo"}},[a("el-input",{staticClass:"cInput",attrs:{readonly:""},model:{value:t.form.tenderNo,callback:function(e){t.$set(t.form,"tenderNo",e)},expression:"form.tenderNo"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"采购方式",prop:"tenderWay"}},[a("el-input",{staticClass:"cInput",attrs:{readonly:""},model:{value:t.form.tenderWay,callback:function(e){t.$set(t.form,"tenderWay",e)},expression:"form.tenderWay"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"公开/邀请",prop:"tenderType"}},[a("el-input",{staticClass:"cInput",attrs:{readonly:""},model:{value:t.form.tenderType,callback:function(e){t.$set(t.form,"tenderType",e)},expression:"form.tenderType"}})],1)],1)],1),a("h3",[t._v("合同标的清单")]),a("div",{staticClass:"cl"},[a("el-button",{on:{click:t.lAddRow}},[t._v("新增")]),a("el-button",{attrs:{disabled:0===t.lSelectedRows.length},on:{click:t.lDeleteRows}},[t._v("删除")]),a("el-button",{attrs:{disabled:0===t.lSelectedRows.length},on:{click:t.lCopyRows}},[t._v("复制")]),a("el-table",{style:{marginTop:"10px"},attrs:{data:t.lTableData,"row-key":function(t){return t.id},border:"",stripe:""},on:{"selection-change":t.lHandleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),a("el-table-column",{attrs:{label:"序号",prop:"id",width:"60"}}),a("el-table-column",{attrs:{label:"产品名称",prop:"inName",width:"170"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{readonly:""},model:{value:e.row.inName,callback:function(a){t.$set(e.row,"inName",a)},expression:"scope.row.inName"}},[a("i",{staticClass:"el-icon-search",staticStyle:{"margin-top":"10px"},attrs:{slot:"suffix"},on:{click:function(a){return t.openCp(e.row)}},slot:"suffix"})]),a("el-dialog",{attrs:{title:"产品名称",visible:t.cpDialog},on:{"update:visible":function(e){t.cpDialog=e}}},[a("el-table",{ref:"singleTable",staticStyle:{width:"100%"},attrs:{data:t.deviceList,"highlight-current-row":""},on:{"row-click":t.handleRowClick}},[a("el-table-column",{attrs:{prop:"tName",label:"产品名称",width:"140"}}),a("el-table-column",{attrs:{prop:"tid",label:"产品编号",width:"130"}}),a("el-table-column",{attrs:{prop:"tModel",label:"规格型号",width:"150"}}),a("el-table-column",{attrs:{prop:"tUnit",label:"单位",width:"85"}}),a("el-table-column",{attrs:{prop:"tPrice",label:"单价",width:"120"}}),a("el-table-column",{attrs:{prop:"shui",label:"税点",width:"100"}})],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.queryParams.pageNum,limit:t.queryParams.pageSize},on:{"update:page":function(e){return t.$set(t.queryParams,"pageNum",e)},"update:limit":function(e){return t.$set(t.queryParams,"pageSize",e)},pagination:t.selectBdList}}),a("div",{staticStyle:{"margin-top":"20px"}},[a("el-button",{on:{click:t.closeDialog1}},[t._v("取消")])],1)],1)]}}])}),a("el-table-column",{attrs:{label:"产品编码",prop:"tid",width:"163"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{readonly:""},model:{value:e.row.tid,callback:function(a){t.$set(e.row,"tid",a)},expression:"scope.row.tid"}})]}}])}),a("el-table-column",{attrs:{label:"规格型号",prop:"inModel",width:"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{readonly:""},model:{value:e.row.inModel,callback:function(a){t.$set(e.row,"inModel",a)},expression:"scope.row.inModel"}})]}}])}),a("el-table-column",{attrs:{label:"单位",prop:"inUnit",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{readonly:""},model:{value:e.row.inUnit,callback:function(a){t.$set(e.row,"inUnit",a)},expression:"scope.row.inUnit"}})]}}])}),a("el-table-column",{attrs:{label:"含税单价",prop:"inVat",width:"130"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{readonly:""},model:{value:e.row.inVat,callback:function(a){t.$set(e.row,"inVat",a)},expression:"scope.row.inVat"}})]}}])}),a("el-table-column",{attrs:{label:"数量",prop:"inCount",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input-number",{staticStyle:{width:"120px"},attrs:{min:1,precision:0,"controls-position":"right"},on:{blur:function(a){return t.spCountBlur(e.row)},change:function(a){return t.spCountChange(e.row)}},model:{value:e.row.inCount,callback:function(a){t.$set(e.row,"inCount",a)},expression:"scope.row.inCount"}})]}}])}),a("el-table-column",{attrs:{label:"小计",prop:"inSubtotal",width:"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{readonly:""},model:{value:e.row.inSubtotal,callback:function(a){t.$set(e.row,"inSubtotal",a)},expression:"scope.row.inSubtotal"}})]}}])})],1),a("div",{style:{textAlign:"right"}},[a("span",{style:{marginRight:"100px"}},[t._v("总价:")]),a("span",{style:{fontWeight:"700"}},[t._v(t._s(t.lTotalSubtotal.toFixed(2)))])])],1),a("h3",[t._v("合同付款约定")]),a("div",{staticClass:"cl"},[a("el-button",{on:{click:t.payAddRow}},[t._v("新增")]),a("el-button",{attrs:{disabled:0===t.paySelectedRows.length},on:{click:t.payDeleteRows}},[t._v("删除")]),a("el-button",{attrs:{disabled:0===t.paySelectedRows.length},on:{click:t.payCopyRows}},[t._v("复制")]),a("el-table",{style:{marginTop:"10px"},attrs:{data:t.payTableData,"row-key":function(t){return t.id},border:"",stripe:""},on:{"selection-change":t.payHandleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),a("el-table-column",{attrs:{label:"序号",prop:"id",width:"60"}}),a("el-table-column",{attrs:{label:"款项内容",prop:"payContent"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-select",{staticClass:"cInput",model:{value:e.row.payContent,callback:function(a){t.$set(e.row,"payContent",a)},expression:"scope.row.payContent"}},t._l(t.payTypes,(function(t){return a("el-option",{key:t.dictValue,attrs:{label:t.dictLabel,value:Number(t.dictValue)}})})),1)]}}])}),a("el-table-column",{attrs:{label:"付款日期"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"block"},[a("el-date-picker",{attrs:{type:"date",placeholder:"选择日期"},model:{value:e.row.payDate,callback:function(a){t.$set(e.row,"payDate",a)},expression:"scope.row.payDate"}})],1)]}}])}),a("el-table-column",{attrs:{label:"付款单位",prop:"payer"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{readonly:""},model:{value:e.row.payer,callback:function(a){t.$set(e.row,"payer",a)},expression:"scope.row.payer"}})]}}])}),a("el-table-column",{attrs:{label:"收款合同方",prop:"hName"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{readonly:""},model:{value:e.row.hName,callback:function(a){t.$set(e.row,"hName",a)},expression:"scope.row.hName"}})]}}])}),a("el-table-column",{attrs:{label:"付款条件",prop:"payTerms"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{model:{value:e.row.payTerms,callback:function(a){t.$set(e.row,"payTerms",a)},expression:"scope.row.payTerms"}})]}}])}),a("el-table-column",{attrs:{label:"付款金额",prop:"payAmount"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{on:{blur:function(a){return t.payHandleBlur(e.row)},input:function(a){return t.payHandleInput(e.row)}},model:{value:e.row.payAmount,callback:function(a){t.$set(e.row,"payAmount",a)},expression:"scope.row.payAmount"}})]}}])}),a("el-table-column",{attrs:{label:"违约责任",prop:"debty"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{model:{value:e.row.debty,callback:function(a){t.$set(e.row,"debty",a)},expression:"scope.row.debty"}})]}}])})],1)],1),a("h3",[t._v("合同签署状态")]),a("el-form",{ref:"qsForm",attrs:{model:t.qsFormData,rules:t.rules2,size:"medium","label-width":"180px","label-position":"left"}},[a("el-row",{staticStyle:{"flex-wrap":"wrap"},attrs:{type:"flex",justify:"space-between",align:"top",gutter:15}},[a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"签署方数",prop:"gnSignatorycount"}},[a("el-select",{staticClass:"cInput",on:{change:t.qsHandleChange},model:{value:t.qsFormData.gnSignatorycount,callback:function(e){t.$set(t.qsFormData,"gnSignatorycount",e)},expression:"qsFormData.gnSignatorycount"}},t._l(t.qsOptions,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"我方主体",prop:"gnSub"}},[a("el-input",{staticClass:"cInput",model:{value:t.qsFormData.gnSub,callback:function(e){t.$set(t.qsFormData,"gnSub",e)},expression:"qsFormData.gnSub"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"乙方供应商",prop:"gnPbname"}},[a("el-input",{staticClass:"cInput",model:{value:t.qsFormData.gnPbname,callback:function(e){t.$set(t.qsFormData,"gnPbname",e)},expression:"qsFormData.gnPbname"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"乙方供应商地址",prop:"gnPbaddress"}},[a("el-input",{staticClass:"cInput",attrs:{clearable:""},model:{value:t.qsFormData.gnPbaddress,callback:function(e){t.$set(t.qsFormData,"gnPbaddress",e)},expression:"qsFormData.gnPbaddress"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"乙方联系人",prop:"gnPbcontact"}},[a("el-input",{staticClass:"cInput",attrs:{clearable:""},model:{value:t.qsFormData.gnPbcontact,callback:function(e){t.$set(t.qsFormData,"gnPbcontact",e)},expression:"qsFormData.gnPbcontact"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"乙方联系方式",prop:"gnPbcif"}},[a("el-input",{staticClass:"cInput",attrs:{clearable:""},model:{value:t.qsFormData.gnPbcif,callback:function(e){t.$set(t.qsFormData,"gnPbcif",e)},expression:"qsFormData.gnPbcif"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"乙方开户行",prop:"gnPbbank"}},[a("el-input",{staticClass:"cInput",attrs:{clearable:""},model:{value:t.qsFormData.gnPbbank,callback:function(e){t.$set(t.qsFormData,"gnPbbank",e)},expression:"qsFormData.gnPbbank"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"乙方开户行账户",prop:"gnPbaccount"}},[a("el-input",{staticClass:"cInput",attrs:{clearable:""},model:{value:t.qsFormData.gnPbaccount,callback:function(e){t.$set(t.qsFormData,"gnPbaccount",e)},expression:"qsFormData.gnPbaccount"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"合同方金额",prop:"gnPbamount"}},[a("el-input",{staticClass:"cInput",attrs:{clearable:"",readonly:""},model:{value:t.qsFormData.gnPbamount,callback:function(e){t.$set(t.qsFormData,"gnPbamount",e)},expression:"qsFormData.gnPbamount"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"币别",prop:"gnPbcurrency"}},[a("el-input",{staticClass:"cInput",attrs:{clearable:""},model:{value:t.qsFormData.gnPbcurrency,callback:function(e){t.$set(t.qsFormData,"gnPbcurrency",e)},expression:"qsFormData.gnPbcurrency"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"已支付金额",prop:"gnPbpayment"}},[a("el-input",{staticClass:"cInput",attrs:{clearable:""},model:{value:t.qsFormData.gnPbpayment,callback:function(e){t.$set(t.qsFormData,"gnPbpayment",e)},expression:"qsFormData.gnPbpayment"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"锁定金额",prop:"gnPbfixedprice"}},[a("el-input",{staticClass:"cInput",attrs:{clearable:""},model:{value:t.qsFormData.gnPbfixedprice,callback:function(e){t.$set(t.qsFormData,"gnPbfixedprice",e)},expression:"qsFormData.gnPbfixedprice"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"剩余金额",prop:"gnPbbalance"}},[a("el-input",{staticClass:"cInput",attrs:{clearable:""},model:{value:t.qsFormData.gnPbbalance,callback:function(e){t.$set(t.qsFormData,"gnPbbalance",e)},expression:"qsFormData.gnPbbalance"}})],1)],1),1===t.qsFormData.gnSignatorycount?a("div",[a("el-divider",{attrs:{direction:"horizontal"}}),a("el-row",{staticStyle:{"flex-wrap":"wrap"},attrs:{type:"flex",justify:"space-between",align:"top",gutter:15}},[a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"丙方供应商",prop:"gnPcname"}},[a("el-input",{staticClass:"cInput",attrs:{clearable:""},model:{value:t.qsFormData.gnPcname,callback:function(e){t.$set(t.qsFormData,"gnPcname",e)},expression:"qsFormData.gnPcname"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"丙方供应商地址",prop:"gnPcaddress"}},[a("el-input",{staticClass:"cInput",attrs:{clearable:""},model:{value:t.qsFormData.gnPcaddress,callback:function(e){t.$set(t.qsFormData,"gnPcaddress",e)},expression:"qsFormData.gnPcaddress"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"丙方联系人",prop:"gnPccontact"}},[a("el-input",{staticClass:"cInput",attrs:{clearable:""},model:{value:t.qsFormData.gnPccontact,callback:function(e){t.$set(t.qsFormData,"gnPccontact",e)},expression:"qsFormData.gnPccontact"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"丙方联系方式",prop:"gnPccif"}},[a("el-input",{staticClass:"cInput",attrs:{clearable:""},model:{value:t.qsFormData.gnPccif,callback:function(e){t.$set(t.qsFormData,"gnPccif",e)},expression:"qsFormData.gnPccif"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"丙方开户行",prop:"gnPcbank"}},[a("el-input",{staticClass:"cInput",attrs:{clearable:""},model:{value:t.qsFormData.gnPcbank,callback:function(e){t.$set(t.qsFormData,"gnPcbank",e)},expression:"qsFormData.gnPcbank"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"丙方开户行账户",prop:"gnPcaccount"}},[a("el-input",{staticClass:"cInput",attrs:{clearable:""},model:{value:t.qsFormData.gnPcaccount,callback:function(e){t.$set(t.qsFormData,"gnPcaccount",e)},expression:"qsFormData.gnPcaccount"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"合同方金额",prop:"gnPcamount"}},[a("el-input",{staticClass:"cInput",attrs:{clearable:""},model:{value:t.qsFormData.gnPcamount,callback:function(e){t.$set(t.qsFormData,"gnPcamount",e)},expression:"qsFormData.gnPcamount"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"币别",prop:"gnPccurrency"}},[a("el-input",{staticClass:"cInput",attrs:{clearable:""},model:{value:t.qsFormData.gnPccurrency,callback:function(e){t.$set(t.qsFormData,"gnPccurrency",e)},expression:"qsFormData.gnPccurrency"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"已支付金额",prop:"gnPcpayment"}},[a("el-input",{staticClass:"cInput",attrs:{clearable:""},model:{value:t.qsFormData.gnPcpayment,callback:function(e){t.$set(t.qsFormData,"gnPcpayment",e)},expression:"qsFormData.gnPcpayment"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"锁定金额",prop:"gnPcfixedprice"}},[a("el-input",{staticClass:"cInput",attrs:{clearable:""},model:{value:t.qsFormData.gnPcfixedprice,callback:function(e){t.$set(t.qsFormData,"gnPcfixedprice",e)},expression:"qsFormData.gnPcfixedprice"}})],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"剩余金额",prop:"gnPcbalance"}},[a("el-input",{staticClass:"cInput",attrs:{clearable:""},model:{value:t.qsFormData.gnPcbalance,callback:function(e){t.$set(t.qsFormData,"gnPcbalance",e)},expression:"qsFormData.gnPcbalance"}})],1)],1)],1):t._e()],1),a("h3",[t._v("合同签署文件")]),a("el-form",{ref:"elForm",attrs:{model:t.form,rules:t.rules3,size:"medium","label-width":"180px","label-position":"left"}},[a("el-row",{staticStyle:{"flex-wrap":"wrap"},attrs:{type:"flex",justify:"space-between",align:"top",gutter:15}},[a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"合同影像上传",prop:"eImage"}},[a("el-upload",{ref:"up1",staticClass:"upload-demo",attrs:{action:t.url,"before-remove":t.beforeRemove1,"auto-upload":!1,limit:1,"on-exceed":t.handleExceed1,"on-success":t.success1,"on-change":t.onchange1,"file-list":t.fileList1,"on-preview":t.handlePreview1}},[a("el-button",{attrs:{size:"small",type:"primary"}},[t._v("上传合同影像")])],1)],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"附件上传",prop:"ComPubAttachments"}},[a("el-upload",{ref:"up2",staticClass:"upload-demo",attrs:{action:t.url,"before-remove":t.beforeRemove2,"auto-upload":!1,limit:1,"on-exceed":t.handleExceed2,"on-success":t.success2,"on-change":t.onchange2,"file-list":t.fileList2,"on-preview":t.handlePreview2}},[a("el-button",{attrs:{size:"small",type:"primary"}},[t._v("上传附件")])],1)],1),a("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"合同文件",prop:"eDocuments"}},[a("el-upload",{ref:"up3",staticClass:"upload-demo",attrs:{action:t.url,"before-remove":t.beforeRemove3,"auto-upload":!1,limit:1,"on-exceed":t.handleExceed3,"on-success":t.success3,"on-change":t.onchange3,"file-list":t.fileList3,"on-preview":t.handlePreview3}},[a("el-button",{attrs:{size:"small",type:"primary"}},[t._v("上传合同文件")])],1)],1)],1)],1)],1),a("div",{staticStyle:{"margin-top":"20px"}},[a("el-button",{attrs:{size:"medium"},on:{click:t.back1}},[t._v("返回")]),a("el-button",{attrs:{size:"medium",type:"primary"},on:{click:t.addXy}},[t._v("提交")])],1)])},n=[],o=(a(28743),a(21509)),s=a(30855),i={data(){return{fileList1:[],fileList2:[],fileList3:[],url:"/prod-api/basic/supplier/upload1",eid:this.$route.query.eid,lTableData:[],total:0,total1:0,queryParams:{pageNum:1,pageSize:10,tName:null,tUnit:null,shui:null,tModel:null,tPrice:null,tid:null},queryParams1:{pageNum:1,pageSize:10,hName:null,hid:null,hQuality:null},supplierList:[],deviceList:[],sub:"",cpDialog:!1,GysDialog:!1,qsOptions:[{value:0,label:"双方签署"},{value:1,label:"三方签署"}],payTimeValue:"",lTotalSubtotal:0,lTableColumns:[],lSelectedRows:[],payTableData:[],paySelectedRows:[],payDateOptions:[],qdSelectedItem:"",mjOptions:[{value:1,label:"非密"},{value:2,label:"商密"}],cgOptions:[{value:1,label:"邀请招标"},{value:2,label:"公开招标"}],cgValue:"",loading:!0,title:"",open:!1,form:{hid:null,gid:null,sid:null,eid:null,eHname:null,eHcode:null,eType:null,eCon:1,eStatus:3,eStartdate:null,eEnddate:null,eAmount:0,eDescription:null,tenderName:null,tenderNo:null,tenderWay:null,tenderType:null,eImage:null,eDocuments:null,eOpinion:null,eDeliveryTime:null,bsSign:{},comPubAttachments:{}},payForm:{eid:null,payContent:null,payDate:null,payer:null,hid:null,hName:null,payTerms:null,payAmount:0,debty:null},tenderTypes:[],payTypes:[],qsFormData:{gnSignatorycount:0,gnSub:"鸿鹄科技有限公司",gnPbid:null,gnPbname:null,gnPbaddress:null,gnPbcontact:null,gnPbcif:null,gnPbbank:null,gnPbaccount:null,gnPbamount:null,gnPbcurrency:"人民币",gnPbpayment:null,gnPbfixedprice:null,gnPbbalance:null,gnPcname:null,gnPcaddress:null,gnPccontact:null,gnPccif:null,gnPcbank:null,gnPcaccount:null,gnPcamount:null,gnPccurrency:null,gnPcpayment:null,gnPcfixedprice:null,gnPcbalance:null},hid:2,rules1:{eHname:[{required:!0,message:"合同名称不能为空",trigger:"blur"}],eStartdate:[{required:!0,message:"开始时间不能为空",trigger:"blur"}],eEnddate:[{required:!0,message:"结束时间不能为空",trigger:"blur"}]},rules2:{},rules3:{},selectRow:null,ComPubAttachments:{anSize:null,anUrl:null,anName:null}}},mounted(){this.lCalculateTotalSubtotal()},created(){this.selectContractByEid(),this.selectListInventory(),this.selectListPayment(),this.getSign(),this.getComPubAttachments(),this.getDicts("bs_contract_pay").then((t=>{this.payTypes=t.data}))},methods:{handlePreview1(){window.open(this.fileList1[0].url,"_blank","charset=utf-8")},handlePreview2(){window.open(this.fileList2[0].url,"_blank","charset=utf-8")},handlePreview3(){window.open(this.fileList3[0].url,"_blank","charset=utf-8")},onchange1(t,e){this.fileList1=e,console.log(this.fileList1,"fileList1 onchange"),0==t.size&&(this.$message.error("选择的文件不能为空，请重新选择！"),this.fileList1.splice(this.fileList1.indexOf(t[0]),1))},onchange2(t,e){this.fileList2=e,console.log(this.fileList2,"fileList2 onchange"),0==t.size&&(this.$message.error("选择的文件不能为空，请重新选择！"),this.fileList2.splice(this.fileList1.indexOf(t[0]),1))},onchange3(t,e){this.fileList3=e,console.log(this.fileList3,"fileList3 onchange"),0==t.size&&(this.$message.error("选择的文件不能为空，请重新选择！"),this.fileList3.splice(this.fileList1.indexOf(t[0]),1))},addXy(){this.submitNextUpload()},add(){console.log("add-----------------"),this.form.gid=this.gid,this.form["bsInventoryList"]=[...this.lTableData].filter((t=>(delete t.id,null!=t.tid))),this.form["bsPaymentList"]=[...this.payTableData].filter((t=>(delete t.id,!(null==t.payContent||null==t.payAmount)))),this.form.bsSign=this.qsFormData,this.form.comPubAttachments=this.ComPubAttachments,(0,o.yp)(this.form).then((t=>{console.log(t.msg),"修改成功"===t.msg&&(this.$router.push("/noTender/noContract"),this.$message.success("修改成功"))}))},handleExceed1(t,e){this.$message.warning(`当前限制选择 1 个文件，本次选择了 ${t.length} 个文件，共选择了 ${t.length+e.length} 个文件`)},beforeRemove1(t){return this.$modal.confirm(`确定移除 ${t.name}？`).then((()=>{this.fileList1=[],this.form.eImage=null}))},success1(t){console.log(111),this.form.eImage=t.data.url,console.log("打印up1-------------------------"),console.log(this.form.eImage),this.submitNextUpload()},handleExceed2(t,e){this.$message.warning(`当前限制选择 1 个文件，本次选择了 ${t.length} 个文件，共选择了 ${t.length+e.length} 个文件`)},beforeRemove2(t){return this.$modal.confirm(`确定移除 ${t.name}？`).then((()=>{this.fileList2=[],this.ComPubAttachments.anUrl=null,this.ComPubAttachments.anName=null,this.ComPubAttachments.anSize=null}))},success2(t,e){console.log(222),this.ComPubAttachments.anName=t.data.name,this.ComPubAttachments.anUrl=t.data.url,this.ComPubAttachments.anSize=e.size,console.log("打印up2-------------------------"),console.log(this.ComPubAttachments),this.submitNextUpload()},handleExceed3(t,e){this.$message.warning(`当前限制选择 1 个文件，本次选择了 ${t.length} 个文件，共选择了 ${t.length+e.length} 个文件`)},beforeRemove3(t){return this.$modal.confirm(`确定移除 ${t.name}？`).then((()=>{this.fileList3=[],this.form.eDocuments}))},success3(t){console.log(333),console.log(t),this.form.eDocuments=t.data.url,console.log("打印up3-------------------------"),console.log(this.form.eDocuments),this.submitNextUpload()},submitNextUpload(){this.fileList1.length>0&&null==this.form.eImage?(console.log(1),this.$refs.up1.submit()):this.fileList2.length>0&&null==this.ComPubAttachments.anUrl?(console.log(2),this.$refs.up2.submit()):this.fileList3.length>0&&null==this.form.eDocuments?(console.log(3),this.$refs.up3.submit()):(console.log(4),this.add())},spCountBlur(t){null==t.inVat&&(t.inVat=0),t.inSubtotal=(t.inCount*t.inVat).toFixed(2),this.lCalculateTotalSubtotal()},spCountChange(t){null==t.inVat&&(t.inVat=0),t.inSubtotal=(t.inCount*t.inVat).toFixed(2),this.lCalculateTotalSubtotal()},lCalculateTotalSubtotal(){this.lTotalSubtotal=this.lTableData.reduce(((t,e)=>{let a=e.inSubtotal?parseFloat(e.inSubtotal):0,l=t+a;return this.form.eAmount=l.toFixed(2),this.qsFormData.gnPbamount=l.toFixed(2),l}),0)},selectBdList(){(0,o.n)(this.queryParams).then((t=>{this.deviceList=t.rows,this.total=t.total}))},handleRowClick(t){this.selectRow.inName=t.tName,this.selectRow.tid=t.tid,this.selectRow.inModel=t.tModel,this.selectRow.inUnit=t.tUnit,this.selectRow.tid=t.tid,this.selectRow.inVat=(1.13*t.tPrice).toFixed(2),this.selectRow.inCount=1,this.selectRow.inSubtotal=(this.selectRow.inCount*this.selectRow.inVat).toFixed(2),this.cpDialog=!1,this.lCalculateTotalSubtotal()},handleRowClick1(t){this.selectRow.hName=t.hName,this.selectRow.tid=t.tid,this.GysDialog=!1},closeDialog1(){this.cpDialog=!1},closeDialog2(){this.GysDialog=!1},selectContractByEid(){(0,o.PF)(this.eid).then((t=>{let e=t.data;if(this.form.eid=e.eid,this.form.eHname=e.eHname,this.form.eHcode=e.eHcode,this.form.eDescription=e.eDescription,this.form.eStartdate=e.eStartdate,this.form.eEnddate=e.eEnddate,this.form.eDeliveryTime=e.eDeliveryTime,this.form.eAmount=e.eAmount.toFixed(2),this.form.eType=e.eType,this.form.eCon=e.eCon,this.form.gid=e.gid,null!=e.eImage&&""!==e.eImage){let t=e.eImage.substring(e.eImage.lastIndexOf("/")+1);this.fileList1=[{name:t,url:e.eImage}],this.form.eImage=e.eImage}else this.fileList1=[],this.fileList1.eImage=null;if(null!=e.eDocuments&&""!==e.eDocuments){let t=e.eDocuments.substring(e.eDocuments.lastIndexOf("/")+1);this.fileList3=[{name:t,url:e.eDocuments}],this.form.eDocuments=e.eDocuments}else this.fileList3=[],this.form.eDocuments=null;this.selectTenderBySid()}))},selectTenderBySid(){(0,s.sS)(this.form.gid).then((t=>{console.log(t,"res");let e=t.data;this.form.tenderName=e.gName,this.form.tenderNo=e.gCode,3===e.gTendertype?this.form.tenderWay="询价":5===e.gTendertype?this.form.tenderWay="竞争性谈判":this.form.tenderWay="单一来源",1===e.gIsPublic?this.form.tenderType="公开":this.form.tenderType="邀请",this.form.eType="一般采购合同",this.aid=e.xyId,this.hid=e.hid,this.selectBdList()}))},selectListInventory(){this.loading=!0,(0,o.tb)({eid:this.eid}).then((t=>{let e=t.rows;e.forEach(((t,e)=>{this.lTableData.push({id:e+1,inName:t.inName,inModel:t.inModel,inVat:t.inVat.toFixed(2),inUnit:t.inUnit,inSubtotal:(t.inCount*t.inVat).toFixed(2),tid:t.tid,inCount:t.inCount})})),this.loading=!1,this.lCalculateTotalSubtotal()}))},selectListPayment(){(0,o.H9)({eid:this.eid}).then((t=>{let e=t.rows;e.forEach(((t,e)=>{this.payTableData.push({id:e+1,hid:t.hid,hName:t.hName,payContent:t.payContent,payAmount:t.payAmount.toFixed(2),payDate:t.payDate,payTerms:t.payTerms,payer:t.payer,debty:t.debty})}))}))},getSign(){(0,o.u)({eid:this.eid}).then((t=>{this.qsFormData=t.data}))},getComPubAttachments(){(0,o.Bv)(this.eid).then((t=>{if(console.log("查询附件信息"),console.log(t),null!=t.data){let e=[{name:t.data.anName,url:t.data.anUrl,size:t.data.anSize}];this.fileList2=e,this.ComPubAttachments.anUrl=t.data.anUrl,this.ComPubAttachments.anName=t.data.anName,this.ComPubAttachments.anSize=t.data.anSize}else this.fileList2=[],this.ComPubAttachments.anUrl=null,this.ComPubAttachments.anName=null,this.ComPubAttachments.anSize=null}))},openCp(t){this.selectRow=t,this.cpDialog=!0,this.selectBdList()},qsHandleChange(t){this.qsFormData.gnSignatorycount=t,0==this.gnSignatorycount?this.qsFormData.gnPccurrency=null:this.qsFormData.gnPccurrency="人民币"},back1(){this.$router.back()},lAddRow(){const t={};this.lTableColumns.forEach((e=>{t[e.prop]=""})),t.id=this.lTableData.length+1,t.inSubtotal=(0).toFixed(2),t.inCount=1,this.lTableData.push(t)},lDeleteRows(){this.$confirm("确定删除选中的行吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.lTableData=this.lTableData.filter((t=>!this.lSelectedRows.includes(t))),this.lSelectedRows=[],this.lUpdateRowIds(),this.lCalculateTotalSubtotal(),this.$message({type:"success",message:"删除成功!"})})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},lCopyRows(){const t=this.lSelectedRows.map((t=>({...t})));t.forEach((t=>{t.id=this.lTableData.reduce(((t,e)=>Math.max(e.id,t)),0)+1,this.lTableData.push(t)})),this.lCalculateTotalSubtotal()},lUpdateRowIds(){this.lTableData.forEach(((t,e)=>{t.id=e+1}))},lHandleSelectionChange(t){this.lSelectedRows=t},payAddRow(){const t={};t.id=this.payTableData.length+1,t.payer="鸿鹄科技有限公司",t.hName=this.qsFormData.gnPbname,t.hid=this.form.hid,this.payTableData.push(t)},payDeleteRows(){this.$confirm("确定删除选中的行吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.payTableData=this.payTableData.filter((t=>!this.paySelectedRows.includes(t))),this.paySelectedRows=[],this.payUpdateRowIds(),this.$message({type:"success",message:"删除成功!"})})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},payCopyRows(){const t=this.paySelectedRows.map((t=>({...t})));t.forEach((t=>{t.id=this.payTableData.reduce(((t,e)=>Math.max(e.id,t)),0)+1,this.payTableData.push(t)}))},payUpdateRowIds(){this.payTableData.forEach(((t,e)=>{t.id=e+1}))},payHandleSelectionChange(t){this.paySelectedRows=t},payHandleBlur(t){t.payAmount&&(t.payAmount=parseFloat(t.payAmount).toFixed(2))},payHandleInput(t){t.payAmount=t.payAmount.replace(/[^\d.]/g,"");let e=t.payAmount.indexOf(".");-1!==e&&(t.payAmount=t.payAmount.slice(0,e+1)+t.payAmount.slice(e+1).replace(/\./g,""));let a=t.payAmount.split(".");a[1]&&a[1].length>2&&(t.payAmount=a[0]+"."+a[1].slice(0,2))}}},r=i,c=a(81656),u=(0,c.A)(r,l,n,!1,null,"fa3e91ce",null),m=u.exports},21509:function(t,e,a){a.d(e,{BZ:function(){return s},Bv:function(){return b},D3:function(){return S},Fz:function(){return w},H6:function(){return h},H9:function(){return m},HH:function(){return g},JP:function(){return P},Jo:function(){return C},LJ:function(){return o},Mt:function(){return D},Mv:function(){return d},OO:function(){return y},PF:function(){return c},an:function(){return x},n:function(){return n},px:function(){return v},qB:function(){return r},so:function(){return i},tb:function(){return u},u:function(){return p},yp:function(){return f}});var l=a(35720);function n(t){return(0,l.Ay)({url:"/ppm/device/list",method:"get",params:t})}function o(t){return(0,l.Ay)({url:"/ppm/items/selectItemsDevice",method:"get",params:t})}function s(t){return(0,l.Ay)({url:"/basic/management",method:"post",data:t})}function i(t){return(0,l.Ay)({url:"/basic/management/list",method:"get",params:t})}function r(t){return(0,l.Ay)({url:"/basic/contract",method:"post",data:t})}function c(t){return(0,l.Ay)({url:"/basic/contract/"+t,method:"get"})}function u(t){return(0,l.Ay)({url:"/basic/inventory/list",method:"get",params:t})}function m(t){return(0,l.Ay)({url:"/basic/payment/list",method:"get",params:t})}function p(t){return(0,l.Ay)({url:"/basic/sign/list1",method:"get",params:t})}function d(t){return(0,l.Ay)({url:"/basic/management/"+t,method:"get"})}function h(t){return(0,l.Ay)({url:"/basic/management",method:"put",data:t})}function f(t){return(0,l.Ay)({url:"/basic/contract",method:"put",data:t})}function b(t){return(0,l.Ay)({url:"/basic/contract/selectCom",method:"get",params:{eid:t}})}function g(t){return(0,l.Ay)({url:"/basic/contract/updateoHstatus",method:"put",data:t})}function y(t){return(0,l.Ay)({url:"/basic/contract/del",method:"get",params:{eid:t}})}function w(t){return(0,l.Ay)({url:"/basic/contract/HtCancel",method:"put",data:t})}function D(t){return(0,l.Ay)({url:"/basic/management/XyCancel",method:"get",params:{oid:t}})}function P(t){return(0,l.Ay)({url:"/ppm/framework/XyCancel",method:"get",params:{oid:t}})}function S(t){return(0,l.Ay)({url:"/basic/management/delXy",method:"get",params:{oid:t}})}function v(t){return(0,l.Ay)({url:"/ppm/framework/upOidbyOid",method:"put",data:t})}function C(t){return(0,l.Ay)({url:"/basic/contract/noTender",method:"post",data:t})}function x(t){return(0,l.Ay)({url:"/bidding/candidate/getSuppHid",method:"get",params:{sid:t}})}},30855:function(t,e,a){a.d(e,{Bj:function(){return h},Hs:function(){return m},Jp:function(){return r},Mc:function(){return u},Qf:function(){return c},SW:function(){return d},U7:function(){return o},UA:function(){return p},dd:function(){return i},iU:function(){return n},sS:function(){return s},sZ:function(){return f}});var l=a(35720);function n(t){return(0,l.Ay)({url:"/nonbidding/pro/list",method:"get",params:t})}function o(t){return(0,l.Ay)({url:"/nonbidding/plan/"+t,method:"get"})}function s(t){return(0,l.Ay)({url:"/nonbidding/pro/"+t,method:"get"})}function i(t){return(0,l.Ay)({url:"/nonbidding/items/getItemsDevice",method:"get",params:t})}function r(t){return(0,l.Ay)({url:"/nonbidding/pro/selectQuotation",method:"get",params:t})}function c(t){return(0,l.Ay)({url:"/nonbidding/pro/selectCom",method:"get",params:{aid:t}})}function u(t){return(0,l.Ay)({url:"/nonbidding/pro",method:"put",data:t})}function m(t){return(0,l.Ay)({url:"/nonbidding/pro/list1",method:"get",params:t})}function p(t){return(0,l.Ay)({url:"/nonbidding/pro/addCom",method:"post",data:t,headers:{isRepeatSubmit:!0}})}function d(t){return(0,l.Ay)({url:"/basic/contract/list1",method:"get",params:t})}function h(t){return(0,l.Ay)({url:"/basic/contract/del1",method:"get",params:{eid:t}})}function f(t){return(0,l.Ay)({url:"/nonbidding/pro/delByGfId",method:"delete",params:{gfId:t}})}}}]);