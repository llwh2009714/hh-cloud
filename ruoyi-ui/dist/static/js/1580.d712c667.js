"use strict";(self["webpackChunkruoyi"]=self["webpackChunkruoyi"]||[]).push([[1580,7140],{87140:function(e,t,a){a.r(t),a.d(t,{default:function(){return h}});var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-form",{directives:[{name:"show",rawName:"v-show",value:e.showSearch,expression:"showSearch"}],ref:"queryForm",attrs:{model:e.queryParams,size:"small",inline:!0,"label-width":"68px"}},[a("el-form-item",{attrs:{label:"任务名称",prop:"jobName"}},[a("el-input",{staticStyle:{width:"240px"},attrs:{placeholder:"请输入任务名称",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.jobName,callback:function(t){e.$set(e.queryParams,"jobName",t)},expression:"queryParams.jobName"}})],1),a("el-form-item",{attrs:{label:"任务组名",prop:"jobGroup"}},[a("el-select",{staticStyle:{width:"240px"},attrs:{placeholder:"请选择任务组名",clearable:""},model:{value:e.queryParams.jobGroup,callback:function(t){e.$set(e.queryParams,"jobGroup",t)},expression:"queryParams.jobGroup"}},e._l(e.dict.type.sys_job_group,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"执行状态",prop:"status"}},[a("el-select",{staticStyle:{width:"240px"},attrs:{placeholder:"请选择执行状态",clearable:""},model:{value:e.queryParams.status,callback:function(t){e.$set(e.queryParams,"status",t)},expression:"queryParams.status"}},e._l(e.dict.type.sys_common_status,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"执行时间"}},[a("el-date-picker",{staticStyle:{width:"240px"},attrs:{"value-format":"yyyy-MM-dd",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.dateRange,callback:function(t){e.dateRange=t},expression:"dateRange"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),a("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1),a("el-row",{staticClass:"mb8",attrs:{gutter:10}},[a("el-col",{attrs:{span:1.5}},[a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["monitor:job:remove"],expression:"['monitor:job:remove']"}],attrs:{type:"danger",plain:"",icon:"el-icon-delete",size:"mini",disabled:e.multiple},on:{click:e.handleDelete}},[e._v("删除")])],1),a("el-col",{attrs:{span:1.5}},[a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["monitor:job:remove"],expression:"['monitor:job:remove']"}],attrs:{type:"danger",plain:"",icon:"el-icon-delete",size:"mini"},on:{click:e.handleClean}},[e._v("清空")])],1),a("el-col",{attrs:{span:1.5}},[a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["monitor:job:export"],expression:"['monitor:job:export']"}],attrs:{type:"warning",plain:"",icon:"el-icon-download",size:"mini"},on:{click:e.handleExport}},[e._v("导出")])],1),a("el-col",{attrs:{span:1.5}},[a("el-button",{attrs:{type:"warning",plain:"",icon:"el-icon-close",size:"mini"},on:{click:e.handleClose}},[e._v("关闭")])],1),a("right-toolbar",{attrs:{showSearch:e.showSearch},on:{"update:showSearch":function(t){e.showSearch=t},"update:show-search":function(t){e.showSearch=t},queryTable:e.getList}})],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.jobLogList},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),a("el-table-column",{attrs:{label:"日志编号",width:"80",align:"center",prop:"jobLogId"}}),a("el-table-column",{attrs:{label:"任务名称",align:"center",prop:"jobName","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{label:"任务组名",align:"center",prop:"jobGroup","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[a("dict-tag",{attrs:{options:e.dict.type.sys_job_group,value:t.row.jobGroup}})]}}])}),a("el-table-column",{attrs:{label:"调用目标字符串",align:"center",prop:"invokeTarget","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{label:"日志信息",align:"center",prop:"jobMessage","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{label:"执行状态",align:"center",prop:"status"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("dict-tag",{attrs:{options:e.dict.type.sys_common_status,value:t.row.status}})]}}])}),a("el-table-column",{attrs:{label:"执行时间",align:"center",prop:"createTime",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.parseTime(t.row.createTime)))])]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["monitor:job:query"],expression:"['monitor:job:query']"}],attrs:{size:"mini",type:"text",icon:"el-icon-view"},on:{click:function(a){return e.handleView(t.row)}}},[e._v("详细")])]}}])})],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}}),a("el-dialog",{attrs:{title:"调度日志详细",visible:e.open,width:"700px","append-to-body":""},on:{"update:visible":function(t){e.open=t}}},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"100px",size:"mini"}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"日志序号："}},[e._v(e._s(e.form.jobLogId))]),a("el-form-item",{attrs:{label:"任务名称："}},[e._v(e._s(e.form.jobName))])],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"任务分组："}},[e._v(e._s(e.form.jobGroup))]),a("el-form-item",{attrs:{label:"执行时间："}},[e._v(e._s(e.form.createTime))])],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"调用方法："}},[e._v(e._s(e.form.invokeTarget))])],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"日志信息："}},[e._v(e._s(e.form.jobMessage))])],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"执行状态："}},[0==e.form.status?a("div",[e._v("正常")]):1==e.form.status?a("div",[e._v("失败")]):e._e()])],1),a("el-col",{attrs:{span:24}},[1==e.form.status?a("el-form-item",{attrs:{label:"异常信息："}},[e._v(e._s(e.form.exceptionInfo))]):e._e()],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.open=!1}}},[e._v("关 闭")])],1)],1)],1)},o=[],r=a(5830),s=a(35720);function i(e){return(0,s.Ay)({url:"/schedule/job/log/list",method:"get",params:e})}function n(e){return(0,s.Ay)({url:"/schedule/job/log/"+e,method:"delete"})}function u(){return(0,s.Ay)({url:"/schedule/job/log/clean",method:"delete"})}var d={name:"JobLog",dicts:["sys_common_status","sys_job_group"],data(){return{loading:!0,ids:[],multiple:!0,showSearch:!0,total:0,jobLogList:[],open:!1,dateRange:[],form:{},queryParams:{pageNum:1,pageSize:10,jobName:void 0,jobGroup:void 0,status:void 0}}},created(){const e=this.$route.params&&this.$route.params.jobId;void 0!==e&&0!=e?(0,r.ax)(e).then((e=>{this.queryParams.jobName=e.data.jobName,this.queryParams.jobGroup=e.data.jobGroup,this.getList()})):this.getList()},methods:{getList(){this.loading=!0,i(this.addDateRange(this.queryParams,this.dateRange)).then((e=>{this.jobLogList=e.rows,this.total=e.total,this.loading=!1}))},handleClose(){const e={path:"/monitor/job"};this.$tab.closeOpenPage(e)},handleQuery(){this.queryParams.pageNum=1,this.getList()},resetQuery(){this.dateRange=[],this.resetForm("queryForm"),this.handleQuery()},handleSelectionChange(e){this.ids=e.map((e=>e.jobLogId)),this.multiple=!e.length},handleView(e){this.open=!0,this.form=e},handleDelete(e){const t=this.ids;this.$modal.confirm('是否确认删除调度日志编号为"'+t+'"的数据项？').then((function(){return n(t)})).then((()=>{this.getList(),this.$modal.msgSuccess("删除成功")})).catch((()=>{}))},handleClean(){this.$modal.confirm("是否确认清空所有调度日志数据项？").then((function(){return u()})).then((()=>{this.getList(),this.$modal.msgSuccess("清空成功")})).catch((()=>{}))},handleExport(){this.download("schedule/job/log/export",{...this.queryParams},`log_${(new Date).getTime()}.xlsx`)}}},c=d,m=a(81656),p=(0,m.A)(c,l,o,!1,null,null,null),h=p.exports},51580:function(e,t,a){a.r(t),a.d(t,{default:function(){return v}});var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"box"},[a("div",{staticClass:"top"},[a("h1",{staticClass:"title"},[e._v(e._s(e.title))]),a("span",{staticClass:"describe"},[e._v("基本信息")]),a("el-form",{ref:"form",staticClass:"form",attrs:{"label-position":"top",inline:!0,size:"medium",model:e.form,rules:e.rules,"label-width":"140px"}},[a("el-row",[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"采购计划编号",prop:"aCode"}},[a("el-input",{attrs:{disabled:"",value:"系统自动生成"}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"计划名称",prop:"aName"}},[a("el-input",{attrs:{placeholder:"请输入计划名称"},model:{value:e.form.aName,callback:function(t){e.$set(e.form,"aName",t)},expression:"form.aName"}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"创建人",prop:"createBy"}},[null!=e.form.aid?a("el-input",{attrs:{disabled:""},model:{value:e.form.createBy,callback:function(t){e.$set(e.form,"createBy",t)},expression:"form.createBy"}}):a("el-input",{attrs:{value:"系统自动生成",disabled:""}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"创建部门"}},[a("el-input",{attrs:{value:e.form.aid||"系统自动生成",disabled:""}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"附件",prop:"fjAnnex"}},[a("div",[a("el-upload",{ref:"upload",attrs:{action:e.upload.url,headers:e.upload.headers,"file-list":e.upload.fileList,multiple:!0,"on-progress":e.handleFileUploadProgress,"on-success":e.handleFileSuccess,limit:5,"on-exceed":e.exceedingMaximumLimit,"on-error":e.uploadError,"before-upload":e.beforeUpload,"before-remove":e.beforeRemove,"on-remove":e.removeFile,"auto-upload":!1}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选取文件")]),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success",loading:e.upload.isUploading},on:{click:e.submitUpload}},[e._v("上传到服务器 ")])],1)],1)])],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"行项目数量",prop:"aProjectCount"}},[a("el-input",{attrs:{disabled:"",placeholder:"系统自动生成"},model:{value:e.form.aProjectCount,callback:function(t){e.$set(e.form,"aProjectCount",e._n(t))},expression:"form.aProjectCount"}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"采购业务类型名称",prop:"aBtype"}},[a("el-select",{staticStyle:{width:"202px"},attrs:{placeholder:"请选择采购业务类型名称"},model:{value:e.form.aBtype,callback:function(t){e.$set(e.form,"aBtype",t)},expression:"form.aBtype"}},e._l(e.dict.type.ppm_procurement_plan,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1)],1)],1),a("div",{staticClass:"top"},[a("h1",{staticClass:"title"},[e._v("预算信息")]),a("span",{staticClass:"describe"},[e._v("添加预算")]),a("div",{staticClass:"material_information"},[a("div",{staticClass:"botton"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.showAddBudget}},[e._v("添加预算")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"max-height":"250",data:e.budgetList}},[a("el-table-column",{attrs:{label:"预算ID",align:"center",prop:"duId"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.duId))])]}}])}),a("el-table-column",{attrs:{label:"部门名称",align:"center",prop:"duDept"}}),a("el-table-column",{attrs:{label:"预算科目名称",align:"center",prop:"duName"}}),a("el-table-column",{attrs:{label:"总金额",align:"center",prop:"duTotal"}}),a("el-table-column",{attrs:{label:"已使用金额",align:"center",prop:"duUsedMoney"}}),a("el-table-column",{attrs:{fixed:"right",label:"操作",align:"center","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-popconfirm",{attrs:{"confirm-button-text":"删除","cancel-button-text":"取消",icon:"el-icon-info","icon-color":"red",title:"你确定要删除编号为"+t.row.aid+"吗？"},on:{confirm:function(a){return e.handleDeleteBudget(t.row,t.$index)}}},[a("el-button",{attrs:{slot:"reference",size:"mini",type:"text",icon:"el-icon-delete"},slot:"reference"},[e._v("删除 ")])],1)]}}])})],1)],1)]),a("div",{staticClass:"content top"},[a("h1",{staticClass:"title"},[e._v("物料信息")]),a("span",{staticClass:"describe"},[e._v("添加物料")]),a("div",{staticClass:"material_information"},[a("div",{staticClass:"botton"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"mini"},on:{click:e.addMaterial}}),a("el-button",{attrs:{type:"primary",icon:"el-icon-minus",size:"mini"},on:{click:e.delMaterial}}),a("el-button",{attrs:{type:"primary",icon:"el-icon-copy-document",size:"mini"}})],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"elTable",staticStyle:{"margin-top":"20px"},attrs:{"max-height":"250",data:e.device,border:""}},[a("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),a("el-table-column",{attrs:{label:"序号",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.$index+1))])]}}])}),a("el-table-column",{attrs:{label:"行项目编号",align:"center",prop:"vCode",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[null==e.form.aid?a("span",[e._v("自动生成")]):a("el-input",{staticClass:"borderNone",attrs:{disabled:""},model:{value:t.row.vCode,callback:function(a){e.$set(t.row,"vCode",a)},expression:"scope.row.vCode"}})]}}])}),a("el-table-column",{attrs:{label:"物料编号",align:"center",prop:"tid",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.tid))]),a("i",{staticClass:"el-icon-search",on:{click:function(a){return e.search(t.$index)}}})]}}])}),a("el-table-column",{attrs:{label:"数量",align:"center",prop:"vCount",width:"230"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input-number",{attrs:{step:1,"step-strictly":""},model:{value:t.row.vCount,callback:function(a){e.$set(t.row,"vCount",a)},expression:"scope.row.vCount"}})]}}])}),a("el-table-column",{attrs:{label:"采购人",align:"center",prop:"vPerson",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{staticClass:"borderNone",model:{value:t.row.vPerson,callback:function(a){e.$set(t.row,"vPerson",a)},expression:"scope.row.vPerson"}})]}}])}),a("el-table-column",{attrs:{label:"交付时间",align:"center",prop:"vDeliveryTime",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"block"},[a("el-date-picker",{attrs:{type:"date",placeholder:"选择日期"},model:{value:t.row.vDeliveryTime,callback:function(a){e.$set(t.row,"vDeliveryTime",a)},expression:"scope.row.vDeliveryTime"}})],1)]}}])}),a("el-table-column",{attrs:{label:"交付地点",align:"center",prop:"vDeliveryArea",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{staticClass:"borderNone",model:{value:t.row.vDeliveryArea,callback:function(a){e.$set(t.row,"vDeliveryArea",a)},expression:"scope.row.vDeliveryArea"}},[e._v(" "+e._s(e.parseTime(t.row.tDate,"{y}-{m}-{d}"))+" ")])]}}])}),a("el-table-column",{attrs:{label:"需求说明",align:"center",prop:"vIllustrate",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{staticClass:"borderNone",model:{value:t.row.vIllustrate,callback:function(a){e.$set(t.row,"vIllustrate",a)},expression:"scope.row.vIllustrate"}})]}}])}),a("el-table-column",{attrs:{label:"预算",align:"center",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"margin-right":"10px"}},[e._v(e._s(t.row.did))]),a("i",{staticClass:"el-icon-search",on:{click:function(a){return e.searchBudget(t.$index)}}})]}}])}),a("el-table-column",{attrs:{fixed:"right",label:"操作",align:"center","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["system:record:remove"],expression:"['system:record:remove']"}],attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(a){return e.handleDelete(t.row,t.$index)}}},[e._v("删除 ")])]}}])})],1)],1)]),a("div",{staticClass:"button",attrs:{slot:"footer"},slot:"footer"},[null==this.form.aid?a("el-button",{attrs:{type:"primary"},on:{click:e.sumbitPlan}},[e._v("提 交 ")]):a("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{type:"warning"},on:{click:e.updatePlanByAid}},[e._v("修 改 ")]),a("el-button",{on:{click:e.goBack}},[e._v("返 回")])],1),a("el-dialog",{attrs:{title:"收货地址",visible:e.show.open,width:"42%"},on:{"update:visible":function(t){return e.$set(e.show,"open",t)}}},[a("el-form",{ref:"queryForm",attrs:{model:e.form,size:"small",inline:!0,"label-width":"68px"}},[a("el-form-item",{attrs:{label:"产品编码",prop:"tid"}},[a("el-input",{attrs:{placeholder:"请输入产品编码",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.tid,callback:function(t){e.$set(e.queryParams,"tid",t)},expression:"queryParams.tid"}})],1),a("el-form-item",{attrs:{label:"产品名称",prop:"tName"}},[a("el-input",{attrs:{placeholder:"请输入产品名称",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.tName,callback:function(t){e.$set(e.queryParams,"tName",t)},expression:"queryParams.tName"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),a("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.show.deviceLoding,expression:"show.deviceLoding"}],attrs:{"max-height":"300",border:"",data:e.newDevice},on:{"cell-dblclick":e.selectedMateria}},[a("el-table-column",{attrs:{label:"产品编码",align:"center",prop:"tid"}}),a("el-table-column",{attrs:{label:"产品名称",align:"center",prop:"tName"}})],1),a("div",{staticClass:"pagination-container",class:{hidden:e.hidden}},[a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getMaterialList}})],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.cancel}},[e._v("关 闭")])],1)],1),a("el-dialog",{attrs:{title:"添加预算",visible:e.show.openBudget,width:"500px","append-to-body":""},on:{"update:visible":function(t){return e.$set(e.show,"openBudget",t)}}},[a("el-form",{ref:"budgetValidateForm",staticStyle:{display:"flex","flex-wrap":"wrap","justify-content":"space-between"},attrs:{inline:!0,"label-position":"top",model:e.budgetForm,rules:e.budRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"预算编号",prop:"newCheckedRuleForm"}},[a("el-input",{attrs:{value:"系统自动生成",disabled:""}})],1),a("el-form-item",{attrs:{label:"部门名称",prop:"duDept"}},[a("el-input",{attrs:{placeholder:"请输入部门名称"},model:{value:e.budgetForm.duDept,callback:function(t){e.$set(e.budgetForm,"duDept",t)},expression:"budgetForm.duDept"}})],1),a("el-form-item",{attrs:{label:"预算科目名称",prop:"duName"}},[a("el-input",{attrs:{placeholder:"请输入预算科目名称"},model:{value:e.budgetForm.duName,callback:function(t){e.$set(e.budgetForm,"duName",t)},expression:"budgetForm.duName"}})],1),a("el-form-item",{attrs:{label:"总金额",prop:"duTotal"}},[a("el-input",{attrs:{placeholder:"请输入总金额"},model:{value:e.budgetForm.duTotal,callback:function(t){e.$set(e.budgetForm,"duTotal",e._n(t))},expression:"budgetForm.duTotal"}})],1),a("el-form-item",{attrs:{label:"已使用金额",prop:"duUsedMoney"}},[a("el-input",{attrs:{placeholder:"请输入已使用金额"},model:{value:e.budgetForm.duUsedMoney,callback:function(t){e.$set(e.budgetForm,"duUsedMoney",e._n(t))},expression:"budgetForm.duUsedMoney"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{type:"primary"},on:{click:e.submitBudgetForm}},[e._v("提 交 ")]),a("el-button",{on:{click:e.cancel}},[e._v("返 回")])],1)],1),a("el-dialog",{attrs:{visible:e.show.changeBudget},on:{"update:visible":function(t){return e.$set(e.show,"changeBudget",t)}}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"max-height":"300",data:e.budgetList},on:{"cell-dblclick":e.doubleClickBudget}},[a("el-table-column",{attrs:{label:"预算ID",align:"center",prop:"aid"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.$index+1))])]}}])}),a("el-table-column",{attrs:{label:"部门名称",align:"center",prop:"duDept"}}),a("el-table-column",{attrs:{label:"预算科目名称",align:"center",prop:"duName"}}),a("el-table-column",{attrs:{label:"总金额",align:"center",prop:"duTotal"}}),a("el-table-column",{attrs:{label:"已使用金额",align:"center",prop:"duUsedMoney"},scopedSlots:e._u([{key:"default",fn:function(t){return[null!=t.row.duUsedMoney&&""!=t.row.duUsedMoney?a("span",[e._v(e._s(t.row.duUsedMoney))]):a("span",{staticStyle:{color:"#cccccc"}},[e._v("未添加")])]}}])})],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.cancel}},[e._v("返 回")])],1)],1)],1)},o=[],r=(a(28743),a(43603)),s=a(35865),i=a(35720);function n(e){return(0,i.Ay)({url:"/ppm/budget",method:"post",data:e})}function u(e){return(0,i.Ay)({url:"/ppm/budget/"+e,method:"delete"})}function d(e){return(0,i.Ay)({url:"/ppm/budget/BudgetBy?aid="+e,method:"post"})}var c=a(50393),m=a(31052),p=a(76177),h=(a(87140),{dicts:["ppm_procurement_plan"],data(){return{hidden:{type:Boolean,default:!1},fullscreenLoading:!1,total:0,newDevice:[],codeRuleForm:[],checkedRuleForm:null,newCheckedRuleForm:null,device:[],budRules:{duDept:[{required:!0,message:"请输入部门名称",trigger:"blur"}],duName:[{required:!0,message:"请输入预算科目名称",trigger:"blur"}],duTotal:[{required:!0,message:"请输入总金额",trigger:"blur"},{type:"number",message:"已用金额必须是数字"}],duUsedMoney:[{type:"number",message:"已用金额必须是数字"}]},title:"新增采购计划",upload:{isUploading:!1,headers:{Authorization:"Bearer "+(0,r.gf)()},url:"/prod-api/ppm/file/upload",fileList:[],fileSecuss:[]},form:{fjAnnex:""},loading:!1,previewCode:null,rules:{aName:[{required:!0,message:"计划名称不能为空",trigger:"blur"}],aCreateDept:[{required:!0,message:"创建部门不能为空",trigger:"blur"}],aBtype:[{required:!0,message:"业务类型不能为空",trigger:"blur"}]},budgetList:[],budgetForm:{},show:{open:!1,openBudget:!1,codeDisabled:!1,changeBudget:!1,deviceLoding:!1},queryParams:{pageNum:1,pageSize:10,tName:null,tid:null},selectedIndex:0}},created(){let e=this.$route.query;if(e.aid)return this.form=e,void this.getItemsByPlanId();let t=localStorage.getItem("procurementPlanID");null==t&&void 0==t&&(0,c.SK)().then((e=>{localStorage.setItem("procurementPlanID",e)})).catch((e=>{m.Message.error("服务器异常请稍后重试！！"),setTimeout((()=>{this.$router.back()}),2e3)}))},beforeDestroy(){localStorage.removeItem("procurementPlanID"),console.log("页面销毁---------------")},methods:{removeFile(e,t){if(console.log(e,this.upload.fileSecuss),this.form.aid){if("success"==e.status){let t=e;t["aid"]=this.form.aid,t["anName"]=t["name"],t["anUrl"]=t["url"],this.$modal.loading("删除中....."),(0,p.yA)(t,"success").then((e=>{this.$modal.closeLoading()})).catch((e=>{this.$modal.closeLoading(),this.$modal.msgError("服务器出错，请联系管理员！！！")}))}}else this.upload.fileSecuss=this.upload.fileSecuss.filter((t=>!t["name"].includes(e["name"].substring(0,e["name"].indexOf(".")))))},beforeRemove(e,t){return this.$confirm(`确定移除 ${e.name}？`)},beforeUpload(e){const t=e.size/1024/1024<2;return t||this.$modal.msgError("文件大小不可超过2MB"),t},uploadError(e,t,a){this.upload.isUploading=!1,this.$modal.msgError(e)},exceedingMaximumLimit(e,t){this.$modal.msgError("最多上传文件5个！！")},submitUpload(){this.$refs.upload.submit()},handleFileUploadProgress(e,t,a){this.upload.isUploading=!0},handleFileSuccess(e,t,a){if(200==e.code)if(this.form.aid){let t=e.data.data;t["aid"]=this.form.aid,t["anName"]=t["name"],t["anUrl"]=t["url"],this.$modal.loading("上传中....."),(0,p.yA)(t,"insert").then((e=>{if(200==e.code)return this.$modal.msgSuccess(e.msg),1;this.$modal.msgSuccess("文件上传失败"),this.$modal.closeLoading()})).catch((e=>{this.$modal.closeLoading(),this.$modal.msgError("服务器出错，请联系管理员！！！")}))}else this.upload.fileSecuss.push(e.data.data),this.$modal.msgSuccess("文件上成功，需要点击提交按钮才可生效！！");this.upload.isUploading=!1},handleAdd(){this.upload.fileList=[]},handleUpdate(e){this.upload.fileList=[{name:this.form.fileName,url:this.form.filePath}]},handleDelete(e,t){this.device.splice(t,1)},addMaterial(){this.device.push({})},delMaterial(){let e=this.$refs.elTable.selection;console.log("t",e),console.log("index",e[0])},search(e){console.log(e,"index"),this.selectedIndex=e,this.show.open=!0,0==this.newDevice.length&&this.getMaterialList()},handleQuery(){this.getMaterialList()},resetQuery(){this.queryParams={pageNum:1,pageSize:10,tName:null,tid:null},this.getMaterialList()},getMaterialList(){this.show.deviceLoding=!0,(0,s.n)(this.queryParams).then((e=>{this.newDevice=e.rows,this.total=e.total,this.show.deviceLoding=!1})).catch((e=>{this.show.deviceLoding=!1,this.$modal.msgError("服务器出错，请联系管理员！！！"+e)}))},cancel(){this.show.open=!1,this.show.openBudget=!1,this.show.changeBudget=!1},selectedMateria(e){let t=this.device[this.selectedIndex];t={...t,tid:e.tid},this.device.splice(this.selectedIndex,1,t),this.show.open=!1},showAddBudget(){this.budgetList.length>0&&(this.show.codeDisabled=!0),this.show.openBudget=!0},submitBudgetForm(){this.$refs["budgetValidateForm"].validate((e=>{if(!e)return console.log("324"),!1;{let e=this.budgetForm;this.form.aid?e["aid"]=this.form.aid:e["aid"]=localStorage.getItem("procurementPlanID"),this.fullscreenLoading=!0,n(e).then((t=>{e["duId"]=t.msg,this.budgetList.push(e),this.budgetForm={},this.fullscreenLoading=!1,this.show.openBudget=!1})).catch((e=>{this.fullscreenLoading=!1,this.$modal.msgError("服务器出错，请联系管理员！！！")}))}}))},handleDeleteBudget(e,t){this.$modal.loading("删除中....."),u(e.duId).then((e=>{this.$modal.closeLoading(),this.$modal.msgSuccess("删除成功!!!!"),this.budgetList.splice(t,1)})).catch((e=>{this.$modal.closeLoading(),this.$modal.msgError("服务器出错，请联系管理员！！！")}))},changeCode(e){let t=this.codeRuleForm.filter((t=>t.targetForm==e))[0];console.log("obj",t);var a=new Date;let l=t.prefix;null!=t.year&&(l+=a.getFullYear()),null!=t.mouth&&(l+=a.getMonth()+1),null!=t.day&&(l+=a.getDay()),null!=t.hour&&(l+=a.getHours()),null!=t.minute&&(l+=a.getMinutes()),null!=t.second&&(l+=a.getSeconds()),l+="001",this.budgetForm.previewCode=l},searchBudget(e){this.selectedIndex=e,this.show.changeBudget=!0},doubleClickBudget(e){let t=this.device[this.selectedIndex];t={...t,did:e.duId},this.device.splice(this.selectedIndex,1,t),this.show.changeBudget=!1,console.log("row",t)},goBack(){this.$router.back()},sumbitPlan(){this.$refs["form"].validate((e=>{if(e){if(0==this.device.length)return this.$modal.msgError("请至少添加一条物料信息"),!1;if(this.device.some((e=>!e.tid)))return void this.$modal.msgError("所有行项目设备不能为空");if(0==this.upload.fileSecuss.length)this.$modal.confirm("系统检测到你还未上传附件是否需要继续提交？").then((()=>{this.$modal.loading("添加中！！"),this.form["items"]=this.device,this.form["aCode"]=localStorage.getItem("procurementPlanID"),(0,c.PY)(this.form).then((e=>{this.$modal.closeLoading(),m.Message.success("添加成功"),setTimeout((()=>{this.$router.back()}),1e3)})).catch((e=>{this.$modal.closeLoading(),this.$modal.msgError("服务器出错，请联系管理员！！！")}))})).catch((()=>{this.$modal.msgError("请上传附件！！"),window.scrollTo({top:0,behavior:"smooth"})}));else{let e="",t="";this.upload.fileSecuss.forEach(((a,l)=>{e+=a.url+",",t+=a.name+","}));let a={anUrl:e,anName:t};this.form["items"]=this.device,this.form["file"]=a,this.form["aCode"]=localStorage.getItem("procurementPlanID"),this.$modal.loading("添加中！！"),(0,c.PY)(this.form).then((e=>{this.$modal.closeLoading(),m.Message.success("添加成功"),setTimeout((()=>{this.$router.back()}),1e3)})).catch((e=>{this.$modal.closeLoading(),this.$modal.msgError("服务器出错，请联系管理员！！！")}))}}else window.scrollTo({top:0,behavior:"smooth"})}))},getItemsByPlanId(){(0,c.Gb)(this.form.aid).then((e=>{e.data&&(this.device=e.data.items)})).catch((e=>{this.$modal.msgError("服务器出错，请联系管理员！！！"+e)})),d(this.form.aCode).then((e=>{this.budgetList=e.data})).catch((e=>{this.$modal.msgError("服务器出错，请联系管理员！！！"+e)})),(0,p.o5)(this.form.aid).then((e=>{if(e.data){let t=e.data.anName.split(","),a=e.data.anUrl.split(",");a.forEach(((e,l)=>{this.upload.fileList.push({name:t[l],url:a[l]})}))}})).catch((e=>{this.$modal.msgError("文件加载失败，请联系管理员！！")}))},updatePlanByAid(){this.$refs["form"].validate((e=>{if(e){if(0==this.device.length)return this.$modal.msgError("请至少添加一条物料信息"),!1;if(this.device.some((e=>!e.tid)))return void this.$modal.msgError("所有行项目设备不能为空");this.form["items"]=this.device,this.fullscreenLoading=!0,(0,c.JM)(this.form).then((e=>{this.fullscreenLoading=!1,this.$modal.msgSuccess("操作成功！！"),setTimeout((()=>{this.$router.back()}),1e3)})).catch((e=>{this.fullscreenLoading=!1,this.$modal.msgError("服务器出错，请联系管理员！！！")}))}}))}}}),g=h,f=a(81656),b=(0,f.A)(g,l,o,!1,null,"04bb1fe2",null),v=b.exports},35865:function(e,t,a){a.d(t,{n:function(){return o}});var l=a(35720);function o(e){return(0,l.Ay)({url:"/ppm/device/list",method:"get",params:e})}},76177:function(e,t,a){a.d(t,{o5:function(){return o},yA:function(){return r}});var l=a(35720);function o(e){return(0,l.Ay)({url:"/ppm/attachments/selectedComPubAttamentsByAid",method:"post",data:{aid:e}})}function r(e,t){return(0,l.Ay)({url:"/ppm/attachments/updateComPubAttamentsByAid?status="+t,method:"post",data:e})}},5830:function(e,t,a){a.d(t,{Sk:function(){return o},ax:function(){return r},b5:function(){return n},lh:function(){return i},uq:function(){return d},vO:function(){return s},w2:function(){return u}});var l=a(35720);function o(e){return(0,l.Ay)({url:"/schedule/job/list",method:"get",params:e})}function r(e){return(0,l.Ay)({url:"/schedule/job/"+e,method:"get"})}function s(e){return(0,l.Ay)({url:"/schedule/job",method:"post",data:e})}function i(e){return(0,l.Ay)({url:"/schedule/job",method:"put",data:e})}function n(e){return(0,l.Ay)({url:"/schedule/job/"+e,method:"delete"})}function u(e,t){const a={jobId:e,status:t};return(0,l.Ay)({url:"/schedule/job/changeStatus",method:"put",data:a})}function d(e,t){const a={jobId:e,jobGroup:t};return(0,l.Ay)({url:"/schedule/job/run",method:"put",data:a})}}}]);