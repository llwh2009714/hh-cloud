"use strict";(self["webpackChunkruoyi"]=self["webpackChunkruoyi"]||[]).push([[5596],{55596:function(t,e,a){a.r(e),a.d(e,{default:function(){return c}});var l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container",staticStyle:{padding:"30px 80px"}},[a("div",{staticClass:"cl"},[a("el-descriptions",{staticClass:"cl",attrs:{title:"| 协议基本信息",column:2,size:t.size,"label-style":t.labelStyle,border:""}},[a("el-descriptions-item",{attrs:{span:2}},[a("template",{slot:"label"},[t._v(" 协议名称 ")]),[a("el-input",{attrs:{placeholder:"请输入协议名称",readonly:""},model:{value:t.queryParams.oName,callback:function(e){t.$set(t.queryParams,"oName",e)},expression:"queryParams.oName"}})]],2),a("el-descriptions-item",[a("template",{slot:"label"},[t._v(" 协议编号 ")]),[a("el-input",{attrs:{placeholder:"系统自动生成",disabled:""},model:{value:t.queryParams.oCode,callback:function(e){t.$set(t.queryParams,"oCode",e)},expression:"queryParams.oCode"}})]],2),a("el-descriptions-item",[a("template",{slot:"label"},[t._v(" 协议类型 ")]),[a("el-input",{attrs:{readonly:""},model:{value:t.queryParams.oType,callback:function(e){t.$set(t.queryParams,"oType",e)},expression:"queryParams.oType"}})]],2),a("el-descriptions-item",{attrs:{span:2}},[a("template",{slot:"label"},[t._v(" 协议说明 ")]),a("template",{slot:"default"},[a("el-input",{staticClass:"cInput",attrs:{type:"textarea",rows:3,clearable:"",readonly:""},model:{value:t.queryParams.oDescribe,callback:function(e){t.$set(t.queryParams,"oDescribe",e)},expression:"queryParams.oDescribe"}})],1)],2),a("el-descriptions-item",[a("template",{slot:"label"},[t._v(" 签署主体 ")]),a("template",{slot:"default"},[a("el-input",{staticClass:"cll",attrs:{readonly:""},model:{value:t.queryParams.oSubject,callback:function(e){t.$set(t.queryParams,"oSubject",e)},expression:"queryParams.oSubject"}})],1)],2),a("el-descriptions-item",[a("template",{slot:"label"},[t._v(" 相对方 ")]),a("template",{slot:"default"},[a("el-input",{staticClass:"cll",attrs:{readonly:""},model:{value:t.queryParams.hName,callback:function(e){t.$set(t.queryParams,"hName",e)},expression:"queryParams.hName"}})],1)],2),a("el-descriptions-item",[a("template",{slot:"label"},[t._v(" 签署日期 ")]),[a("el-date-picker",{staticClass:"cInput",attrs:{type:"date",readonly:""},model:{value:t.queryParams.oStartdate,callback:function(e){t.$set(t.queryParams,"oStartdate",e)},expression:"queryParams.oStartdate"}})]],2),a("el-descriptions-item",[a("template",{slot:"label"},[t._v(" 失效日期 ")]),[a("el-date-picker",{staticClass:"cInput",attrs:{type:"date",readonly:""},model:{value:t.queryParams.oEnddate,callback:function(e){t.$set(t.queryParams,"oEnddate",e)},expression:"queryParams.oEnddate"}})]],2),a("el-descriptions-item",[a("template",{slot:"label"},[t._v(" 协议文件 ")]),[a("el-upload",{ref:"up1",staticClass:"upload-demo",attrs:{action:t.url,"on-preview":t.handlePreview,"before-remove":t.beforeRemove,"auto-upload":!1,limit:1,"on-exceed":t.handleExceed,"on-success":t.success,"file-list":t.fileList,"on-change":t.onchange1,disabled:""}},[a("el-button",{attrs:{size:"small",type:"primary"}},[t._v("上传框架协议文件")])],1)]],2)],1),a("div",{staticClass:"cl1"},[t._m(0),a("el-table",{style:{marginTop:"10px"},attrs:{data:t.lTableData,"row-key":function(t){return t.id},border:"",stripe:""},on:{"selection-change":t.lHandleSelectionChange}},[a("el-table-column",{attrs:{label:"序号",prop:"id",width:"60"}}),a("el-table-column",{attrs:{label:"产品名称",prop:"inName",width:"170"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{readonly:""},model:{value:e.row.inName,callback:function(a){t.$set(e.row,"inName",a)},expression:"scope.row.inName"}},[a("i",{staticClass:"el-icon-search",staticStyle:{"margin-top":"10px"},attrs:{slot:"suffix"},on:{click:function(t){}},slot:"suffix"})]),a("el-dialog",{attrs:{title:"产品名称",visible:t.cpDialog},on:{"update:visible":function(e){t.cpDialog=e}}},[a("el-table",{ref:"singleTable",staticStyle:{width:"100%"},attrs:{data:t.deviceList,"highlight-current-row":""},on:{"row-click":t.handleRowClick}},[a("el-table-column",{attrs:{prop:"tName",label:"产品名称",width:"140"}}),a("el-table-column",{attrs:{prop:"tid",label:"产品编号",width:"130"}}),a("el-table-column",{attrs:{prop:"tModel",label:"规格型号",width:"150"}}),a("el-table-column",{attrs:{prop:"tUnit",label:"单位",width:"85"}}),a("el-table-column",{attrs:{prop:"tPrice",label:"单价",width:"120"}}),a("el-table-column",{attrs:{prop:"shui",label:"税点",width:"100"}})],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.queryParams.pageNum,limit:t.queryParams.pageSize},on:{"update:page":function(e){return t.$set(t.queryParams,"pageNum",e)},"update:limit":function(e){return t.$set(t.queryParams,"pageSize",e)},pagination:t.selectBdList}})],1)]}}])}),a("el-table-column",{attrs:{label:"产品编码",prop:"tid",width:"165"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{readonly:""},model:{value:e.row.tid,callback:function(a){t.$set(e.row,"tid",a)},expression:"scope.row.tid"}})]}}])}),a("el-table-column",{attrs:{label:"规格型号",prop:"inModel",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{readonly:""},model:{value:e.row.inModel,callback:function(a){t.$set(e.row,"inModel",a)},expression:"scope.row.inModel"}})]}}])}),a("el-table-column",{attrs:{label:"单位",prop:"inUnit",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{readonly:""},model:{value:e.row.inUnit,callback:function(a){t.$set(e.row,"inUnit",a)},expression:"scope.row.inUnit"}})]}}])}),a("el-table-column",{attrs:{label:"含税单价",prop:"inVat",width:"130"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{readonly:""},model:{value:e.row.inVat,callback:function(a){t.$set(e.row,"inVat",a)},expression:"scope.row.inVat"}})]}}])}),a("el-table-column",{attrs:{label:"数量",prop:"inCount",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input-number",{staticStyle:{width:"120px"},attrs:{min:1,precision:0,"controls-position":"right"},on:{blur:function(a){return t.spCountBlur(e.row)},change:function(a){return t.spCountChange(e.row)}},model:{value:e.row.inCount,callback:function(a){t.$set(e.row,"inCount",a)},expression:"scope.row.inCount"}})]}}])}),a("el-table-column",{attrs:{label:"小计",prop:"inSubtotal"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{readonly:""},model:{value:e.row.inSubtotal,callback:function(a){t.$set(e.row,"inSubtotal",a)},expression:"scope.row.inSubtotal"}})]}}])})],1),a("div",{style:{textAlign:"right"}},[a("span",{style:{marginRight:"100px"}},[t._v("总价:")]),a("span",{style:{fontWeight:"700"}},[t._v(t._s(parseFloat(t.oTotalprice).toFixed(2)))])])],1)],1),2===this.queryParams.oHstatus?a("div",[t._m(1),a("el-form",{ref:"elForm",attrs:{model:t.sub,rules:t.rules,size:"medium","label-width":"180px","label-position":"left"}},[a("el-row",{staticStyle:{"flex-wrap":"wrap"},attrs:{type:"flex",justify:"space-between",align:"top",gutter:15}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"",prop:"oOpinion"}},[a("el-input",{staticClass:"cInput",attrs:{type:"textarea",rows:4,clearable:""},model:{value:t.sub.oOpinion,callback:function(e){t.$set(t.sub,"oOpinion",e)},expression:"sub.oOpinion"}})],1)],1)],1)],1):t._e(),a("el-button",{attrs:{size:"medium"},on:{click:t.back1}},[t._v("返回")]),2===this.queryParams.oHstatus?a("el-button",{attrs:{size:"medium",type:"primary"},on:{click:t.updateHt}},[t._v("通过")]):t._e(),2===this.queryParams.oHstatus?a("el-button",{attrs:{size:"medium",type:"danger"},on:{click:t.updateBh}},[t._v("驳回")]):t._e()],1)},i=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("h4",[a("strong",[t._v("| 设备信息")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("h4",[a("strong",[t._v("| 审核意见")])])}],o=(a(28743),a(21509)),s={name:"AddFa",data(){return{url:"/prod-api/basic/supplier/upload1",oTotalprice:0,oid:this.$route.query.oid,labelStyle:{width:"180px",textAlign:"center"},textColor:{color:"#00afff"},size:"0",queryParams:{oid:null,tid:null,oCode:null,oName:null,oSubject:"鸿鹄科技有限公司",hid:null,hName:null,oStartdate:null,oEnddate:null,oFile:null,oType:"采购框架协议",oHstatus:null,oDescribe:null,oOpinion:null},sub:{oHstatus:null,oid:null,oOpinion:null},view:null,rules:{oOpinion:[{required:!0,message:"审核意见不能为空",trigger:"blur"}]},fileList:[],lTotalSubtotal:0,lTableColumns:[],lSelectedRows:[],lTableData:[],deviceList:[],cpDialog:!1,total:0}},created(){this.hh(),this.xx()},watch:{"queryParams.oStartdate":function(t){if(t){const e=new Date(t),a=new Date(e.getFullYear()+2,e.getMonth(),e.getDate());this.queryParams.oEnddate=a.toISOString().slice(0,10)}}},methods:{addFa(){this.submitNextUpload()},add(){this.queryParams["oTotalprice"]=parseFloat(this.oTotalprice).toFixed(2),this.queryParams["bsInventoryList"]=[...this.lTableData].filter((t=>(delete t.id,null!=t.tid))),(0,o.H6)(this.queryParams).then((t=>{console.log(t),"修改成功"===t.msg&&this.$router.push("/contract/fam")}))},onchange1(t,e){this.fileList=e,console.log(this.fileList,"fileList onchange"),0===t.size&&(this.$message.error("选择的文件不能为空，请重新选择！"),this.fileList.splice(this.fileList.indexOf(t[0]),1))},updateHt(){this.$refs.elForm.validate().then((()=>{this.sub.oHstatus=3,this.sub.oid=this.oid,(0,o.H6)(this.sub).then((t=>{console.log(t.msg),"修改成功"===t.msg?(this.$message.success("已通过"),this.$router.push("/contract/fam")):this.$message.success("修改失败")}))})).catch((()=>{this.$message.warning("请填写审核意见")}))},updateBh(){this.$refs.elForm.validate().then((()=>{this.sub.oHstatus=4,this.sub.oid=this.oid,(0,o.H6)(this.sub).then((t=>{console.log(t.msg),"修改成功"===t.msg?(this.$message.error("已驳回"),this.$router.push("/contract/fam")):this.$message.success("修改失败")}))})).catch((()=>{this.$message.warning("请填写审核意见")}))},hh(){this.loading=!0,(0,o.Mv)(this.oid).then((t=>{console.log("打印框架协议信息"),console.log(t),this.queryParams=t.data,this.view=t.data.oOpinion;let e=t.data.oFile;if(null!=e){let a=e.substring(e.lastIndexOf("/")+1);this.fileList=[{name:a,url:e}],t.data.oFile||(this.form.oFile=t.data.oFile)}else this.fileList=[],this.fileList.oFile=null}))},xx(){(0,o.tb)({oid:this.oid}).then((t=>{console.log(t.rows);let e=t.rows;e.forEach(((t,e)=>{this.lTableData.push({id:e+1,inName:t.inName,inModel:t.inModel,inVat:t.inVat.toFixed(2),inUnit:t.inUnit,inSubtotal:(t.inCount*t.inVat).toFixed(2),tid:t.tid,inCount:t.inCount})})),this.loading=!1,this.lCalculateTotalSubtotal()}))},success(t){console.log(333),console.log(t),this.queryParams.oFile=t.data.url,console.log("打印up3-------------------------"),console.log(this.queryParams.oFile),this.submitNextUpload()},handlePreview(t){window.open(this.fileList[0].url,"_blank","charset=utf-8")},handleExceed(t,e){this.$message.warning(`当前限制选择 1 个文件，本次选择了 ${t.length} 个文件，共选择了 ${t.length+e.length} 个文件`)},beforeRemove(t,e){return this.$modal.confirm(`确定移除 ${t.name}？`).then((()=>{this.fileList=[],this.queryParams.oFile=null}))},submitNextUpload(){this.fileList.length>0&&null==this.queryParams.oFile?(console.log("打印提交1-------------------------"),this.$refs.up1.submit()):(console.log("打印提交2-------------------------"),this.add())},lAddRow(){let t={};this.lTableColumns.forEach((e=>{t[e.prop]=""})),t.id=this.lTableData.length+1,t.inVat=(0).toFixed(2),t.inSubtotal=(0).toFixed(2),t.inCount=1,this.lTableData.push(t)},lDeleteRows(){this.$confirm("确定删除选中的行吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.lTableData=this.lTableData.filter((t=>!this.lSelectedRows.includes(t))),this.lSelectedRows=[],this.lUpdateRowIds(),this.lCalculateTotalSubtotal(),this.$message({type:"success",message:"删除成功!"})})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},lCopyRows(){const t=this.lSelectedRows.map((t=>({...t})));t.forEach((t=>{t.id=this.lTableData.reduce(((t,e)=>Math.max(e.id,t)),0)+1,this.lTableData.push(t)})),this.lCalculateTotalSubtotal()},lUpdateRowIds(){this.lTableData.forEach(((t,e)=>{t.id=e+1}))},lHandleSelectionChange(t){this.lSelectedRows=t},openCp(t){this.selectRow=t,this.cpDialog=!0,this.selectBdList()},handleRowClick(t){this.selectRow.inName=t.tName,this.selectRow.tid=t.tid,this.selectRow.inModel=t.tModel,this.selectRow.inUnit=t.tUnit,this.selectRow.inVat=(1.13*t.tPrice).toFixed(2),this.selectRow.inCount=1,this.selectRow.inSubtotal=(this.selectRow.inCount*this.selectRow.inVat).toFixed(2),this.cpDialog=!1,this.lCalculateTotalSubtotal()},selectBdList(){(0,o.n)(this.queryParams).then((t=>{console.log(t),this.deviceList=t.rows,this.total=t.total}))},spCountBlur(t){null==t.inVat&&(t.inVat=0),t.inSubtotal=(t.inCount*t.inVat).toFixed(2),this.lCalculateTotalSubtotal()},spCountChange(t){null==t.inVat&&(t.inVat=0),t.inSubtotal=(t.inCount*t.inVat).toFixed(2),this.lCalculateTotalSubtotal()},lCalculateTotalSubtotal(){this.oTotalprice=this.lTableData.reduce(((t,e)=>{let a=e.inSubtotal?parseFloat(e.inSubtotal):0,l=t+a;return l}),0)},back1(){this.$router.back()}}},n=s,r=a(81656),u=(0,r.A)(n,l,i,!1,null,"5fbb25d4",null),c=u.exports},21509:function(t,e,a){a.d(e,{BZ:function(){return s},Bv:function(){return f},D3:function(){return C},Fz:function(){return w},H6:function(){return h},H9:function(){return d},HH:function(){return y},JP:function(){return x},Jo:function(){return P},LJ:function(){return o},Mt:function(){return v},Mv:function(){return m},OO:function(){return g},PF:function(){return u},an:function(){return q},n:function(){return i},px:function(){return S},qB:function(){return r},so:function(){return n},tb:function(){return c},u:function(){return p},yp:function(){return b}});var l=a(35720);function i(t){return(0,l.Ay)({url:"/ppm/device/list",method:"get",params:t})}function o(t){return(0,l.Ay)({url:"/ppm/items/selectItemsDevice",method:"get",params:t})}function s(t){return(0,l.Ay)({url:"/basic/management",method:"post",data:t})}function n(t){return(0,l.Ay)({url:"/basic/management/list",method:"get",params:t})}function r(t){return(0,l.Ay)({url:"/basic/contract",method:"post",data:t})}function u(t){return(0,l.Ay)({url:"/basic/contract/"+t,method:"get"})}function c(t){return(0,l.Ay)({url:"/basic/inventory/list",method:"get",params:t})}function d(t){return(0,l.Ay)({url:"/basic/payment/list",method:"get",params:t})}function p(t){return(0,l.Ay)({url:"/basic/sign/list1",method:"get",params:t})}function m(t){return(0,l.Ay)({url:"/basic/management/"+t,method:"get"})}function h(t){return(0,l.Ay)({url:"/basic/management",method:"put",data:t})}function b(t){return(0,l.Ay)({url:"/basic/contract",method:"put",data:t})}function f(t){return(0,l.Ay)({url:"/basic/contract/selectCom",method:"get",params:{eid:t}})}function y(t){return(0,l.Ay)({url:"/basic/contract/updateoHstatus",method:"put",data:t})}function g(t){return(0,l.Ay)({url:"/basic/contract/del",method:"get",params:{eid:t}})}function w(t){return(0,l.Ay)({url:"/basic/contract/HtCancel",method:"put",data:t})}function v(t){return(0,l.Ay)({url:"/basic/management/XyCancel",method:"get",params:{oid:t}})}function x(t){return(0,l.Ay)({url:"/ppm/framework/XyCancel",method:"get",params:{oid:t}})}function C(t){return(0,l.Ay)({url:"/basic/management/delXy",method:"get",params:{oid:t}})}function S(t){return(0,l.Ay)({url:"/ppm/framework/upOidbyOid",method:"put",data:t})}function P(t){return(0,l.Ay)({url:"/basic/contract/noTender",method:"post",data:t})}function q(t){return(0,l.Ay)({url:"/bidding/candidate/getSuppHid",method:"get",params:{sid:t}})}}}]);